import{clipboard,color,videoData,genID,fileName,GenerateQRCode}from"./mediaviewer-tools.min.js";
/**
 * @package MediaViewer
 * @version 1.0.0
 * @description A javascript library to create a media viewing experience
 * @license MIT
 * @author XHiddenProjects
 * @repository [XHiddenProjects/MediaViewer](https://github.com/XHiddenProjects/MediaViewer)
 */
export const startup=()=>{const e=document.createElement("link"),t=document.createElement("link"),i=document.createElement("link"),a=document.createElement("link"),s=document.createElement("script");e.href="//cdn.jsdelivr.net/gh/Orlinkzz/fontawesome-pro-v6.7.0@main/css/all.min.css",e.rel="stylesheet",document.head.appendChild(e),t.href="//fonts.googleapis.com/css2?family=Cedarville+Cursive&family=Cutive+Mono&family=Dancing+Script:wght@400..700&family=Handlee&family=PT+Mono&family=PT+Sans+Caption:wght@400;700&family=PT+Serif+Caption:ital@0;1&display=swap",t.rel="stylesheet",document.head.appendChild(t),i.href="./css/mediaviewer.css",i.rel="stylesheet",document.head.appendChild(i),a.rel="stylesheet",a.href="./css/mediaviewer-mobile.css",document.head.appendChild(a),s.src="https://cdn.jsdelivr.net/gh/ushelp/EasyQRCodeJS@master/src/easy.qrcode.js",document.head.appendChild(s),document.documentElement.setAttribute("media-viewer-enabled","")};const isLoaded=()=>document.documentElement.hasAttribute("media-viewer-enabled");export class Carousel{#e;constructor(e,t,i,a=!0){isLoaded()&&(this.container=document.querySelector(e),this.config={speed:500,interval:5e3,autoplay:!0,loop:!0,slides:[],captions:[],start:0,controls:!1,indicator:!1,transition:"none"},this.styles={},this.interval=null,this.#e=null,this.lastSlide=0,Object.assign(this.config,t),Object.assign(this.styles,i),this.container instanceof HTMLElement&&a&&this.init())}init(){this.currentSlide=this.config.start,this.container.classList.add(this.config.transition),this.container.classList.add("carousel"),Object.keys(this.styles).forEach((e=>{this.container.style.setProperty(`--carousel-${e}`,this.styles[e])})),this.container.innerHTML+='<div class="carousel-inner">'+this.config.slides.map(((e,t)=>`\n            <div class="carousel-slide${t===this.currentSlide?" active":""}">\n                <img class="image" src="${e}" alt="${this.config.captions[t]??"img_"+(t+1)}"/>\n            </div>\n        `)).join("")+"</div>",this.config.autoplay&&this.#t(),this.config.controls&&this.#i(),this.config.indicator&&this.#a(),this.config.captions.length>0&&this.#s()}getInstance(){return this}onSlideChange(e,t=!1){this.#e=e,t&&this.#e({last:this.lastSlide,current:this.currentSlide+1,total:this.config.slides.length,index:this.currentSlide,caption:this.config.captions[this.currentSlide]})}#t(){this.interval=setInterval((()=>{this.#n()}),this.config.interval)}#n(){this.lastSlide=this.currentSlide,this.currentSlide+1<this.config.slides.length?this.currentSlide++:this.config.loop&&(this.currentSlide=0),this.#r(),this.#o()}#r(){const e=this.container.querySelectorAll(".carousel-slide");e.forEach(((t,i)=>{if(i===this.currentSlide){t.classList.add("active"),t.classList.add("carousel-slide-next");const i=this.lastSlide;e[i].classList.add("carousel-slide-prev"),setTimeout((()=>{t.classList.remove("carousel-slide-next"),e[i].classList.remove("carousel-slide-prev")}),this.config.speed)}else t.classList.remove("active")})),this.#e&&this.#e({last:this.lastSlide,current:this.currentSlide+1,total:this.config.slides.length,index:this.currentSlide,caption:this.config.captions[this.currentSlide]})}#i(){const e=document.createElement("button");e.innerHTML='<i class="fa-solid fa-caret-left"></i>',e.classList.add("carousel-prev"),e.addEventListener("click",(()=>{this.#c()}));const t=document.createElement("button");t.innerHTML='<i class="fa-solid fa-caret-right"></i>',t.classList.add("carousel-next"),t.addEventListener("click",(()=>{this.#n()})),this.container.appendChild(e),this.container.appendChild(t)}#s(){this.container.querySelectorAll(".carousel-slide").forEach(((e,t)=>{const i=document.createElement("caption");i.classList.add("carousel-caption"),i.innerText=this.config.captions[t]||"",e.appendChild(i)}))}#a(){const e=document.createElement("div");e.classList.add("carousel-indicators"),e.addEventListener("wheel",(e=>{e.deltaY<0?this.#n():this.#c()})),this.config.slides.forEach(((t,i)=>{const a=document.createElement("span");a.classList.add("carousel-indicator"),i===this.currentSlide&&a.classList.add("active"),a.addEventListener("click",(()=>{this.currentSlide=i,this.#r(),this.#o()})),e.appendChild(a)})),this.container.appendChild(e)}#o(){this.container.querySelectorAll(".carousel-indicator").forEach(((e,t)=>{e.classList.toggle("active",t===this.currentSlide)}))}#c(){this.lastSlide=this.currentSlide,this.currentSlide-1>=0?this.currentSlide--:this.config.loop&&(this.currentSlide=this.config.slides.length-1),this.#r(),this.#o()}}export class Gallery{#e;constructor(e,t,i,a=!0){isLoaded()&&(this.container=document.querySelector(e),this.container.classList.add("gallery"),this.config={images:[],captions:[],zoom:!1,gap:"0px",autoResize:!1,static:!1},this.styles={"max-cols":"1fr",gap:this.config.gap},this.interval=null,this.#e=null,Object.assign(this.config,t),Object.assign(this.styles,i),this.loadImages().then((()=>{this.container instanceof HTMLElement&&a&&this.init()})),this.config.autoResize&&window.addEventListener("resize",(()=>{this.loadImages().then((()=>{this.init()}))})))}async loadImages(){const e=this.config.images.map((e=>new Promise((t=>{const i=new Image;i.src=e,i.onload=()=>t(i)})))),t=await Promise.all(e),i=t.reduce(((e,t)=>e+t.naturalWidth),0),a=Math.floor(document.documentElement.clientWidth/(i/t.length));this.styles["max-cols"]=`${a}`}init(){this.config.images.length>this.config.rows*this.config.cols||(Object.keys(this.styles).forEach((e=>{this.container.style.setProperty(`--gallery-${e}`,this.styles[e])})),this.container.innerHTML+='<div class="gallery-grid">'+this.config.images.map(((e,t)=>`\n            <div class="gallery-item">\n                <img class="image" src="${e}" alt="${this.config.captions[t]??"img_"+(t+1)}"/>\n            </div>\n        `)).join("")+"</div>",this.config.zoom&&this.#l(),this.config.captions.length>0&&this.#s())}getInstance(){return this}#l(){this.config.static&&this.container.classList.add("static"),this.container.classList.add("zoom");const e=document.createElement("div");e.classList.add("gallery-overlay"),this.config.static||e.addEventListener("click",(()=>{e.classList.remove("opened");const t=e.querySelector(".gallery-zoom-caption");t&&t.remove()}));const t=document.createElement("button");t.innerText="x",t.classList.add("gallery-close-button"),t.addEventListener("click",(()=>{e.classList.remove("opened");const t=e.querySelector(".gallery-zoom-caption");t&&t.remove()})),e.appendChild(t);const i=document.createElement("img");i.classList.add("gallery-zoom-image"),e.appendChild(i),this.container.appendChild(e);this.container.querySelectorAll(".gallery-item").forEach(((t,a)=>{t.addEventListener("click",(()=>{if(e.classList.add("opened"),i.src=this.config.images[a],this.config.captions.length>0){const t=document.createElement("div");t.classList.add("gallery-zoom-caption"),t.innerText=this.config.captions[a]||"",e.appendChild(t)}}))}))}#s(){this.container.querySelectorAll(".gallery-item").forEach(((e,t)=>{const i=document.createElement("caption");i.classList.add("gallery-caption"),i.innerText=this.config.captions[t]||"",e.appendChild(i)}))}}export class VideoPlayer{#d;constructor(e,t,i,a=!0){if(!isLoaded())return;this.params=new URLSearchParams(window.location.search),this.container=document.querySelector(e),this.config={embed:!1,poster:"",title:"",autoplay:!1,controls:!0,start:this.params.get("t")?parseInt(this.params.get("t")):0,end:-1,playlists:[],skipRate:5,defaultLang:"en",availableColors:["white","yellow","green","cyan","blue","magenta","red","black"],availableSize:[50,75,100,150,200,300,400],availableOpacity:[0,25,50,75,100],availablePlayback:[.25,.5,.75,1,1.25,1.5,1.75,2],preloaded:"auto",embedURL:`${window.location.origin+window.location.pathname}embed.html`},this.styles={},this.debug={},this.eventTracker={},this.#d=[],Object.assign(this.config,t),Object.assign(this.styles,i),this.config.autoplay=JSON.parse(window.localStorage.getItem("mediaViewer_video_config")).autoplay??this.config.autoplay,this.config.playlists.map((e=>{let t="";genID(fileName(e.src[0].path)).then((e=>{t=e})),setTimeout((()=>{this.#d.some((t=>t.videoName===fileName(e.src[0].path)))||this.#d.push({videoName:fileName(e.src[0].path),videoID:t})}),50)}));let s=0;return this.config.playlists.map((e=>{var t="",i=0;""===e.poster&&videoData(e.src[0].path,1,(e=>{e&&e.poster&&e.duration&&(t=e.poster,i=e.duration)})),s+=1,setTimeout((()=>{if(!new URLSearchParams(window.location.search).get("v")){const e=window.location.search?"&":"?";window.history.pushState({},"",`${window.location.pathname}${e}v=${this.#d[0].videoID}`)}e.poster=t,e.duration=i,s==this.config.playlists.length&&this.container instanceof HTMLElement&&a&&this.init()}),500)})),this}#u(e){switch(e.split(".").pop().toLowerCase()){case"mp4":return"video/mp4";case"webm":return"video/webm";case"ogg":return"video/ogg";default:return"video/mp4"}}init(){this.container.tabIndex=0,this.container.classList.add("video"),this.config.embed&&this.container.classList.add("embed"),Object.keys(this.styles).forEach((e=>{this.container.style.setProperty(`--video-${e}`,this.styles[e])})),this.container.innerHTML+='<div class="video-player"></div>',this.container.querySelector(".video-player").innerHTML=`${window.QRCode?'<div class="QRcode"><span class="close"><i class="fa-solid fa-x"></i></span></div>':""}<div class="playpauseUI" data-status="isPaused">\n            <span class="uiPlayPause"></span>\n        </div>\n        <div class="videoNotFound">\n            <span class="videoNotFoundTxt">Video not found</span>\n            </div><div class="overlay">\n            <i class="fa-solid fa-arrow-up-right-from-square fa-rotate-270 pip-expand" title="Expand (i)"></i>\n            <i class="fa-solid fa-play pip-play-pause"></i>\n        </div>\n        \n        <div class="content-menu-controls">\n            <ul class="controls-menu">\n                <li class="controls-menu-item" data-action="loop"><i class="fa-solid fa-repeat"></i> Loop</li>\n                <li class="controls-menu-item" data-action="copyURL"><i class="fa-solid fa-link"></i> Copy URL</li>\n                <li class="controls-menu-item" data-action="copyTimeURL"><i class="fa-solid fa-link"></i> Copy URL at current time</li>\n                <li class="controls-menu-item" data-action="copyEmbed"><i class="fa-solid fa-code-simple"></i> Copy Embed Code</li>\n                ${window.QRCode?'<li class="controls-menu-item" data-action="openQRCode"><i class="fa-solid fa-qrcode"></i> Generate QRCode</li>':""}\n            </ul>\n        </div>\n        <div class="video-placeholder">\n        <div class="closed-captions-bar">\n            <span class="closed-captions-text"></span>\n        </div>\n        <i class="fa-solid fa-loader bufferLoader"></i>\n        </div>`,this.container.innerHTML+=`<div class="playlists${this.config.playlists.length<2?" noShow":""}">\n            ${Array.from(this.config.playlists).map((e=>`<div class="playlist-item" tab-index="0" data-video="${this.#d.find((t=>t.videoName===fileName(e.src[0].path))).videoID}">\n                        <img src="${e.poster}" class="playlist-img"/>\n                        <span data-video-src="${this.#d.find((t=>t.videoName===fileName(e.src[0].path))).videoID}" class="playlist-timeDur" data-video-duration="${this.#h(e.duration)}">${this.#h(e.duration)}</span>\n                    </div>`)).join("")}\n        </div>`,this.container.innerHTML+=`<div class="video-title"><h1>${this.config.title}</h1></div>`,this.#p(),this.config.controls&&(this.#i(),this.#m(),this.#y(),this.#g(),this.#v(),this.#f(),this.#S(),this.#b())}getInstance(){return this}#i(){this.container.querySelector(".video-player").innerHTML+=`<div class="controls">\n            <div class="preview-container">\n                <div class="preview-frame"></div>\n                    <div class="information">\n                        <span class="chapter"></span>\n                        <span class="timestamp"></span>\n                    </div>\n            </div>\n            <div class="section progress">\n                \n                    \n                <div class="progress-buffer"></div>\n                <div class="progress-checkpoint"></div>\n                <div class="progress-bar"><span class="circle"></span></div>\n            </div>\n            <div class="section">\n                <div class="controller-1">\n                    <i class="fa-solid fa-play btn play-pause" title="Play (k)"></i>\n                    <i class="fa-solid fa-forward-step btn next-video"></i>\n                    <div class="container volume-container">\n                        <div class="volume-holder">\n                        </div>\n                    </div>\n                    <div class="container time-container">\n                        <span class="current-time">00:00</span> / <span class="total-time">00:00</span>\n                    </div>\n                </div>\n                <div class="controller-2">\n                    <label class="toggle-switch" title="Autoplay is off">\n                        <input type="checkbox" class="autoplay" ${this.config.autoplay?' checked="checked"':""}>\n                        <span class="slider"></span>\n                    </label>\n                    <i class="fa-solid fa-closed-captioning btn cc" title="close captions (c)"></i>\n                    <div class="setting-container btn">\n                        <i class="fa-solid fa-gear settings" tabindex="0" title="Settings"></i>\n                        <div class="settings-menu">\n                            <ul class="settings-menu-list">\n                                ${this.container.querySelector('track[kind="subtitles"]')?'<li class="settings-menu-list-item" data-settings="option-cc"><span><i class="fa-regular fa-closed-captioning"></i> Closed Captions</span></li>':""}\n                                <li class="settings-menu-list-item" data-settings="option-playback"><span><i class="fa-regular fa-circle-play"></i> Playback Speed</span></li>\n                                <li class="settings-menu-list-item" data-settings="option-quality"><span><i class="fa-regular fa-sliders"></i> Quality</span></li>\n                            </ul>\n                            <div class="options option-cc">\n                                <div class="options-header">\n                                    <div>\n                                        <span class="settings-back"></span>\n                                        <span>Subtitles/CC</span>\n                                    </div>\n                                    <span class="cc-options">Options</span>\n                                </div>\n                                <ul class="settings-menu-list">\n                                ${Array.from(this.container.querySelectorAll('track[kind="subtitles"]')).map((e=>`<li class="settings-menu-list-item" data-subtitle="${e.srclang}"><span>${e.label}</span></li>`)).join("")}\n                                </ul>\n                            </div>\n                            <div class="options option-playback">\n                                <div class="options-header">\n                                    <div>\n                                        <span class="settings-back"></span>\n                                        <span>Playback</span>\n                                    </div>\n                                </div>\n                                <ul class="settings-menu-list">\n                                ${Array.from(this.config.availablePlayback).map((e=>`<li class="settings-menu-list-item${1==e?" checked":""}" data-speed="${e}"><span>${1==e?"Normal":`${e}x`}</span></li>`)).join("")}\n                                </ul>\n                            </div>\n                            <div class="options option-quality">\n                                <div class="options-header">\n                                    <div>\n                                        <span class="settings-back"></span>\n                                        <span>Quality</span>\n                                    </div>\n                                </div>\n                                <ul class="settings-menu-list">\n                                ${Array.from(this.container.querySelectorAll(".video-frame source[data-quality]")).sort(((e,t)=>{const i="auto"===e.getAttribute("data-quality")?-1:parseInt(e.getAttribute("data-quality")||0,10);return("auto"===t.getAttribute("data-quality")?-1:parseInt(t.getAttribute("data-quality")||0,10))-i})).map((e=>`<li class="settings-menu-list-item${"auto"===e.getAttribute("data-quality")?" checked":""}" data-quality="${e.getAttribute("data-quality")}"><span>${"auto"!==e.getAttribute("data-quality")?`${e.getAttribute("data-quality").charAt(0).toUpperCase()+e.getAttribute("data-quality").slice(1)}p`:`${e.getAttribute("data-quality").charAt(0).toUpperCase()+e.getAttribute("data-quality").slice(1)}`}</span></li>`)).join("")}\n                                </ul>\n                            </div>\n                            <div class="options option-cc-more">\n                                <div class="options-header">\n                                    <div>\n                                        <span class="settings-back-more"></span>\n                                        <span>Options</span>\n                                    </div>\n                                </div>\n                                <ul class="settings-menu-list">\n                                    <li class="settings-menu-list-item">Font Family: \n                                        <select class="settings-menu-select font-family">\n                                            <option value="--family-monospaced-serif">Monospaced Serif</option>\n                                            <option value="--family-proportional-serif">Proportional Serif</option>\n                                            <option value="--family-monospaced-sans-serif">Monospaced Sans Serif</option>\n                                            <option value="--family-proportional-sans-serif" selected="selected">Proportional Sans Serif</option>\n                                            <option value="--family-casual">Casual</option>\n                                            <option value="--family-cursive">Cursive</option>\n                                            <option value="--family-small-capitals">Small Capitals</option>\n                                        </select>\n                                    </li>\n                                    <li class="settings-menu-list-item">Font Color: \n                                        <select class="settings-menu-select font-color">\n                                            ${Array.from(this.config.availableColors).map((e=>`<option value="${e}">${e.charAt(0).toUpperCase()+e.slice(1)}</option>`)).join("")}\n                                        </select>\n                                    </li>\n                                    <li class="settings-menu-list-item">Font Size: \n                                        <select class="settings-menu-select font-size">\n                                            ${Array.from(this.config.availableSize).map((e=>`<option value="${e}"${100==e?' selected="selected"':""}>${e}%</option>`)).join("")}\n                                        </select>\n                                    </li>\n                                    <li class="settings-menu-list-item">Background Color: \n                                        <select class="settings-menu-select bg-color">\n                                            ${Array.from(this.config.availableColors).map((e=>`<option value="${e}">${e.charAt(0).toUpperCase()+e.slice(1)}</option>`)).join("")}\n                                        </select>\n                                    </li>\n                                    <li class="settings-menu-list-item">Background Opacity: \n                                        <select class="settings-menu-select bg-opacity">\n                                            ${Array.from(this.config.availableOpacity).map((e=>`<option value="${e/100}"${75==e?' selected="selected"':""}>${e}%</option>`)).join("")}\n                                        </select>\n                                    </li>\n                                    <li class="settings-menu-list-item">Window Color: \n                                        <select class="settings-menu-select window-color">\n                                            ${Array.from(this.config.availableColors).map((e=>`<option value="${e}">${e.charAt(0).toUpperCase()+e.slice(1)}</option>`)).join("")}\n                                        </select>\n                                    </li>\n                                    <li class="settings-menu-list-item">Window Opacity: \n                                        <select class="settings-menu-select window-opacity">\n                                            ${Array.from(this.config.availableOpacity).map((e=>`<option value="${e/100}"${0==e?' selected="selected"':""}>${e}%</option>`)).join("")}\n                                        </select>\n                                    </li>\n                                    <li class="settings-menu-list-item">Font Opacity: \n                                        <select class="settings-menu-select font-opacity">\n                                            ${Array.from(this.config.availableOpacity).map((e=>`<option value="${e/100}"${100==e?' selected="selected"':""}>${e}%</option>`)).join("")}\n                                        </select>\n                                    </li>\n                                </ul>\n                            </div>\n                        </div>\n                    </div>\n                    <i class="fa-solid fa-arrow-up-right-from-square btn pip" title="Miniplayer (i)"></i>\n                    <i class="fa-regular fa-expand-wide btn theaterMode" title="Theater Mode (t)"></i>\n                    <i class="fa-solid fa-expand fullscreen btn" title="Fullscreen (f)"></i>\n                </div>\n            </div>\n        </div>`,setTimeout((()=>{const e=document.querySelector(".option-quality .settings-menu-list");""===e.innerText.trim()&&(e.innerHTML=Array.from(this.container.querySelectorAll(".video-frame source[data-quality]")).sort(((e,t)=>{const i="auto"===e.getAttribute("data-quality")?-1:parseInt(e.getAttribute("data-quality")||0,10);return("auto"===t.getAttribute("data-quality")?-1:parseInt(t.getAttribute("data-quality")||0,10))-i})).map((e=>`<li class="settings-menu-list-item${"auto"===e.getAttribute("data-quality")?" checked":""}" data-quality="${e.getAttribute("data-quality")}"><span>${"auto"!==e.getAttribute("data-quality")?`${e.getAttribute("data-quality").charAt(0).toUpperCase()+e.getAttribute("data-quality").slice(1)}p`:`${e.getAttribute("data-quality").charAt(0).toUpperCase()+e.getAttribute("data-quality").slice(1)}`}</span></li>`)).join(""))}),100)}#p(){const e=document.createElement("video");e.setAttribute("preload",this.config.preloaded),e.classList.add("video-frame"),e.tabIndex=0,this.config.playlists.map((t=>{t.src.map((t=>{const i=document.createElement("source");i.src=t.path,i.setAttribute("data-quality",t.quality??"auto"),i.type=this.#u(t.path),e.poster=this.config.poster,"auto"===t.quality&&(e.src=t.path),e.appendChild(i)}))})),this.config.tracks?.map((t=>{const i=document.createElement("track");i.src=t.src,i.kind=t.kind,i.srclang=t.srclang,i.label=t.label,e.appendChild(i)}));const t=document.createElement("video");t.classList.add("preview-video"),this.config.playlists.map((e=>{e.src.map((e=>{const i=document.createElement("source");i.setAttribute("data-quality",e.quality??"auto"),i.src=e.path,i.type=this.#u(e.path),t.appendChild(i)}))})),this.container.querySelector(".video-placeholder").appendChild(e),this.container.querySelector(".video-placeholder").appendChild(t)}#m(){const e=document.createElement("i");e.className="fa-solid fa-volume btn volume",e.title="Mute (m)";const t=this.container.querySelector(".video-frame");e.addEventListener("click",(function(){const i=this.parentNode.querySelector("input"),a=this.styles&&this.styles["volume-track-before"]?this.styles["volume-track-before"]:"#e7e7e7",s=this.styles&&this.styles["volume-track-after"]?this.styles["volume-track-after"]:"#c8c8c8";0==i.value?(i.value=100,this.className="fa-solid fa-volume btn volume",e.title="Mute (m)",t.volume=1,i.style.background=`linear-gradient(90deg, ${a} 100%, ${s} 100%)`):(i.value=0,this.className="fa-solid fa-volume-slash btn volume",e.title="Unmute (m)",t.volume=0,i.style.background=`linear-gradient(90deg, ${a} 0%, ${s} 0%)`)})),this.container.querySelector(".volume-container .volume-holder").appendChild(e)}#y(){const e=document.createElement("input");e.type="range",e.classList.add("volumeRange"),e.min=0,e.max=100,e.value=100;const t=this.styles["volume-track-before"]??"#e7e7e7",i=this.styles["volume-track-after"]??"#c8c8c8",a=this.container.querySelector(".video-frame");e.addEventListener("input",(function(){const e=(this.value-this.min)/(this.max-this.min)*100;this.style.background=`linear-gradient(90deg, ${t} ${e}%, ${i} ${e}%)`;const s=this.parentNode.querySelector(".btn");100==this.value&&(s.className="fa-solid fa-volume btn volume"),this.value<100&&this.value>0&&(s.className="fa-solid fa-volume-low btn volume"),0==this.value&&(s.className="fa-solid fa-volume-slash btn volume"),a.volume=this.value/100})),this.container.querySelector(".volume-container .volume-holder").appendChild(e)}#g(){this.container.querySelector(".play-pause").addEventListener("click",(()=>{this.container.querySelector(".video-frame").paused?(this.container.querySelector(".video-frame").play(),this.container.querySelector(".play-pause").title="Pause (k)"):(this.container.querySelector(".video-frame").pause(),this.container.querySelector(".play-pause").title="Play (k)")})),this.container.querySelector(".pip-play-pause").addEventListener("click",(()=>{this.container.querySelector(".video-frame").paused?this.container.querySelector(".video-frame").play():this.container.querySelector(".video-frame").pause()}))}#h(e){const t=Math.floor(e/3600),i=Math.floor(e%3600/60),a=Math.floor(e%60);return t>0?`${String(t).padStart(2,"0")}:${String(i).padStart(2,"0")}:${String(a).padStart(2,"0")}`:`${String(i).padStart(2,"0")}:${String(a).padStart(2,"0")}`}#v(){const e=this.container.querySelector(".video-frame");e.addEventListener("waiting",(function(){this.parentNode.parentNode.querySelector(".bufferLoader").style.display="block",this.parentNode.parentNode.querySelector(".play-pause").setAttribute("disabled",!0)})),e.addEventListener("canplay",(function(){this.parentNode.parentNode.querySelector(".bufferLoader").style.display="none",this.parentNode.parentNode.querySelector(".play-pause").removeAttribute("disabled")})),e.addEventListener("playing",(function(){this.parentNode.parentNode.querySelector(".play-pause").className=this.parentNode.parentNode.querySelector(".play-pause").className.replace("fa-play","fa-pause"),this.parentNode.parentNode.querySelector(".pip-play-pause").className=this.parentNode.parentNode.querySelector(".pip-play-pause").className.replace("fa-play","fa-pause");const e=this.parentNode.parentNode.querySelector(".playpauseUI");e.setAttribute("data-status","isPlaying"),e.classList.add("toggled"),setTimeout((()=>{e.classList.remove("toggled")}),800)})),e.addEventListener("pause",(function(){const e=this.parentNode.parentNode.querySelector(".playpauseUI");e.setAttribute("data-status","isPaused"),e.classList.add("toggled"),setTimeout((()=>{e.classList.remove("toggled")}),800),this.parentNode.parentNode.querySelector(".play-pause").className=this.parentNode.parentNode.querySelector(".play-pause").className.replace("fa-pause","fa-play"),this.parentNode.parentNode.querySelector(".pip-play-pause").className=this.parentNode.parentNode.querySelector(".pip-play-pause").className.replace("fa-pause","fa-play")})),e.addEventListener("timeupdate",(()=>{const t=this.container.querySelector(".progress-bar"),i=e.currentTime/e.duration*100;t.style.width=`${i}%`,this.container.querySelector(".current-time").innerText=this.#h(e.currentTime)})),e.addEventListener("ended",(()=>{if(this.config.autoplay){const e=Array.from(this.container.querySelectorAll(".playlist-item")),t=new URLSearchParams(window.location.search).get("v"),i=e.findIndex((e=>e.getAttribute("data-video")===t));if(-1!==i){e[(i+1)%e.length].querySelector("img").click()}}})),e.addEventListener("progress",(()=>{const t=this.container.querySelector(".progress-buffer");if(e.buffered.length>0){const i=e.buffered.end(e.buffered.length-1)/e.duration*100;t.style.width=`${i}%`}})),this.container.querySelector(".video-player").addEventListener("contextmenu",(e=>{e.preventDefault();const t=this.container.querySelector(".content-menu-controls");t.style.display="block",t.style.left=`${Math.max(0,Math.min(e.clientX,this.container.querySelector(".video-player").clientWidth-t.clientWidth))}px`,t.style.top=`${Math.max(0,Math.min(e.clientY,this.container.querySelector(".video-player").clientHeight-t.clientHeight))}px`,this.container.querySelector(".preview-frame").style.display="none",this.container.querySelector(".information").style.display="none"})),window.addEventListener("click",(e=>{const t=this.container.querySelector(".content-menu-controls");"block"===t.style.display&&(t.style.display="none")})),this.container.querySelector(".autoplay").addEventListener("input",(()=>{const e=this.container.querySelector(".autoplay");window.localStorage.setItem("mediaViewer_video_config",JSON.stringify({autoplay:e.checked})),this.config.autoplay=e.checked,e.parentNode.title="Autoplay is "+(e.checked?"on":"off")})),this.container.querySelectorAll(".content-menu-controls li").forEach((t=>{t.addEventListener("click",(t=>{const i="I"!==t.target.tagName?t.target:t.target.parentNode,a=e.currentSrc;let s;const n=e=>this.#d.find((t=>t.videoName===fileName(e))).videoID;switch(i.getAttribute("data-action").toLocaleLowerCase()){case"loop":i.classList.toggle("checked"),e.loop=!e.loop;break;case"copyurl":this.container.querySelectorAll("source").forEach((e=>{a.match(e.src)&&(s=n(e.getAttribute("src")))})),clipboard.copy(`${window.location.href.replace(/\?(.*)$/,"")}?v=${s}`)?alert("copied to clipboard"):alert("failed to copy");break;case"copytimeurl":this.container.querySelectorAll("source").forEach((e=>{a.match(e.src)&&(s=n(e.getAttribute("src")))})),clipboard.copy(`${window.location.href.replace(/\?(.*)$/,"")}?v=${s}&t=${Math.floor(e.currentTime)}`)?alert("copied to clipboard"):alert("failed to copy");break;case"copyembed":const t=new URLSearchParams(window.location.search).get("v"),r=this.#d.find((e=>e.videoID===t)).videoName;window.localStorage.setItem(`embed_${t}`,JSON.stringify({lists:this.#d,playlists:this.config.playlists.filter((e=>e.src[0].path.match(r)))})),clipboard.copy(`<iframe width="937" height="527" src="${this.config.embedURL}?v=${t}" title="${this.container.querySelector(".video-title").innerText??""}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>`)?alert("Copied to clipboard"):alert("Failed to copy");break;case"openqrcode":this.container.querySelectorAll("source").forEach((e=>{a.match(e.src)&&(s=n(e.getAttribute("src")))})),GenerateQRCode(this.container.querySelector(".QRcode"),{text:`${window.location.href.replace(/\?(.*)$/,"")}?v=${s}`,width:200,height:200,crossOrigin:"anonymous",logo:document.querySelector("link[rel*=icon]")?new URL(document.querySelector("link[rel*=icon]").getAttribute("href"),location.origin):""}),this.container.querySelector(".QRcode").classList.add("show");break;default:break}}))})),this.container.querySelector(".QRcode .close")&&this.container.querySelector(".QRcode .close").addEventListener("click",(function(){this.parentNode.querySelectorAll("canvas").forEach((e=>e.remove())),this.parentNode.classList.remove("show")})),this.container.querySelector(".fullscreen").addEventListener("click",(()=>{if(this.container.classList.toggle("video-fullscreen"),this.container.classList.contains("video-fullscreen")){const e=this.container.querySelector(".fullscreen");e.className=e.className.replace("fa-expand","fa-compress"),e.title="Exit Fullscreen (f)",this.container.requestFullscreen?this.container.requestFullscreen():this.container.mozRequestFullScreen?this.container.mozRequestFullScreen():this.container.webkitRequestFullscreen?this.container.webkitRequestFullscreen():this.container.msRequestFullscreen&&this.container.msRequestFullscreen();this.container.querySelectorAll('track[kind="subtitles"]').forEach((e=>{e.track.mode="hidden"})),this.container.querySelector(".cc").classList.remove("active");!this.container.querySelector('.video-frame track[kind="subtitles"]')||this.container.querySelector(".cc").setAttribute("disabled",!0),this.container.querySelector(".pip").classList.add("hidden"),this.container.querySelector(".theaterMode").classList.add("hidden"),this.container.querySelector(".closed-captions-bar").classList.remove("active")}else{const e=this.container.querySelector(".fullscreen");e.className=e.className.replace("fa-compress","fa-expand"),e.title="Fullscreen (f)",document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen();!this.container.querySelector('.video-frame track[kind="subtitles"]')||this.container.querySelector(".cc").removeAttribute("disabled"),this.container.querySelector(".pip").classList.remove("hidden"),this.container.querySelector(".theaterMode").classList.remove("hidden")}})),this.container.querySelector(".playlists").addEventListener("mouseover",(()=>{this.container.querySelector(".controls").setAttribute("style","transform:translateY(130%);opacity:0;")})),this.container.querySelector(".playlists").addEventListener("mouseleave",(()=>{this.container.querySelector(".controls").removeAttribute("style")})),this.container.querySelector(".video-frame").addEventListener("dblclick",(()=>{this.container.querySelector(".fullscreen").click()})),document.addEventListener("fullscreenchange",(()=>{const e=this.container.querySelector(".fullscreen");if(!document.fullscreenElement&&this.container.classList.contains("video-fullscreen")){this.container.classList.remove("video-fullscreen"),e.className=e.className.replace("fa-compress","fa-expand"),e.title="Fullscreen (f)",this.container.querySelector(".pip").classList.remove("hidden"),this.container.querySelector(".theaterMode").classList.remove("hidden");!this.container.querySelector('.video-frame track[kind="subtitles"]')||this.container.querySelector(".cc").setAttribute("disabled",!1)}})),this.container.querySelector(".pip-expand").addEventListener("click",(()=>{this.container.classList.remove("video-pip")})),this.container.querySelector(".theaterMode").addEventListener("click",(()=>{this.container.classList.toggle("video-theater"),this.container.classList.contains("video-theater")?this.container.querySelector(".theaterMode").className=this.container.querySelector(".theaterMode").className.replace("fa-expand-wide","fa-compress-wide"):(this.container.classList.add("video-theater-closing"),setTimeout((()=>{this.container.classList.remove("video-theater-closing")}),350),this.container.querySelector(".theaterMode").className=this.container.querySelector(".theaterMode").className.replace("fa-compress-wide","fa-expand-wide"))})),window.addEventListener("resize",(()=>{this.container.querySelector(".closed-captions-bar").setAttribute("style",`top:${e.offsetHeight-20}px;`)})),e.addEventListener("loadedmetadata",(()=>{e.querySelectorAll("source").forEach((t=>{const i=new URLSearchParams(window.location.search),a=this.#d.find((e=>e.videoID===i.get("v"))).videoName;t.getAttribute("src").match(/([^/]+)(?=\.[^.]+$)/)[1]===a&&(e.currentTime=this.config.start)})),this.container.querySelectorAll(".playlists [data-video-src]").forEach((e=>{(e=>this.#d.find((t=>t.videoName===fileName(e))).videoID)(this.container.querySelector(".video-frame").src)===e.getAttribute("data-video-src")?e.innerText="Now Playing":e.innerText=e.getAttribute("data-video-duration")})),this.container.querySelector(".closed-captions-bar").setAttribute("style",`top:${e.offsetHeight-20}px;`),this.container.querySelector(".total-time").innerText=this.#h(e.duration);const t=e.textTracks,i=this.container.querySelector(".closed-captions-text");for(let a=0;a<t.length;a++)if("hidden"===t[a].mode){const s=t[a].activeCues;if(s&&s.length>0)i.innerText=s&&s.length>0?s[0].text:"";else{const s=e.currentTime,n=t[a].cues;if(n)for(let e=0;e<n.length;e++){const t=n[e];if(s>=t.startTime&&s<=t.endTime){i.innerText=t.text;break}}}}})),this.container.querySelector(".video-frame").addEventListener("click",(e=>{e.target.paused?e.target.play():e.target.pause()})),this.container.querySelector(".video-frame").addEventListener("keydown",(e=>t(e)));const t=t=>{const i=t.key||t.keyCode||t.which;if(" "!==i&&"k"!==i&&32!==i&&75!==i||this.container.querySelector(".play-pause").click(),"ArrowLeft"!==i&&37!=i||(e.currentTime=Math.max(0,e.currentTime-this.config.skipRate)),"ArrowRight"!==i&&39!=i||(e.currentTime=Math.min(e.duration,e.currentTime+this.config.skipRate)),"m"===i||77==i){const e=this.container.querySelector(".video-frame");e.muted=!e.muted;const t=this.container.querySelector(".volume"),i=this.container.querySelector(".volumeRange"),a=this.styles["volume-track-before"]??"#e7e7e7",s=this.styles["volume-track-after"]??"#c8c8c8";e.muted?(t.className="fa-solid fa-volume-slash btn volume",i.value=i.min,t.title="Unmute (m)",i.style.background=`linear-gradient(90deg, ${a} 0%, ${s} 0%)`):(t.className="fa-solid fa-volume btn volume",i.value=i.max,t.title="Mute (m)",i.style.background=`linear-gradient(90deg, ${a} 100%, ${s} 100%)`)}"i"!==i&&73!=i||(this.container.classList.contains("video-pip")?this.container.querySelector(".pip-expand").click():this.container.querySelector(".pip").click()),"c"!==i&&67!=i||this.container.querySelector(".cc:not([disabled])")&&this.container.querySelector(".cc:not([disabled])").click(),"t"!==i&&84!=i||this.container.querySelector(".theaterMode").click(),"f"!==i&&70!=i||this.container.querySelector(".fullscreen").click()},i=this.container.querySelector(".progress");i.addEventListener("click",(t=>{const a=i.getBoundingClientRect(),s=(t.clientX-a.left)/a.width*e.duration;isFinite(s)&&!isNaN(s)&&(e.currentTime=s)}));var a=!1;i.querySelector(".progress-bar").addEventListener("mousedown",(()=>{a=!0})),i.querySelector(".progress-bar").addEventListener("mouseup",(()=>{a=!1})),i.addEventListener("mousemove",(t=>{if(a){const a=i.getBoundingClientRect(),s=(t.clientX-a.left)/a.width;e.currentTime=s*e.duration}})),i.querySelector(".progress-bar").addEventListener("touchstart",(()=>{a=!0})),i.querySelector(".progress-bar").addEventListener("touchend",(()=>{a=!1})),i.addEventListener("touchmove",(t=>{if(a){const a=i.getBoundingClientRect(),s=(t.touches[0].clientX-a.left)/a.width;e.currentTime=s*e.duration}})),this.container.querySelector(".cc").addEventListener("click",(()=>{this.container.querySelector(".cc").classList.toggle("active"),this.container.querySelector(".closed-captions-bar").classList.toggle("active")})),this.container.querySelector(".pip").addEventListener("click",(()=>{this.container.classList.add("video-pip")})),e.load()}#f(){let e=0;window.addEventListener("click",(()=>{this.config.autoplay&&(e||(this.container.querySelector(".video-frame").play(),e=1))})),this.container.querySelector(".video-frame").addEventListener("loadedmetadata",(()=>{const e=this.container.querySelector('track[kind="chapters"]');e&&(e.addEventListener("load",(e=>{const t=e.target.track;t.mode="hidden";const i=t.cues,a=this.container.querySelector(".progress");i&&Array.from(i).forEach((e=>{const t=document.createElement("span");t.classList.add("chapter-line");const i=e.endTime/this.container.querySelector(".video-frame").duration;t.style.left=`${Math.min(100*i,100)}%`,t.dataset.startTime=e.startTime,t.dataset.endTime=e.endTime,t.dataset.text=e.text,a.appendChild(t)}))})),e.dispatchEvent(new Event("load")))}));const t=this.container.querySelector(".progress"),i=t.querySelector(".progress-checkpoint");t.addEventListener("mouseleave",(()=>{i.style.width="0%",this.container.querySelector(".preview-frame").style.display="none"})),this.container.querySelectorAll(".preview-frame, .information, .section, .video-frame, .section.progress").forEach((e=>{e.addEventListener("mouseenter",(e=>{i.style.width="0%",this.container.querySelector(".preview-frame").style.display="none"}))})),t.addEventListener("mousemove",(e=>{const a=t.getBoundingClientRect();let s=e.clientX-a.left;s=Math.max(0,Math.min(s,a.width));const n=s/a.width;i.style.width=100*n+"%";const r=this.container.querySelector(".preview-frame"),o=this.container.querySelector(".preview-video"),c=document.createElement("canvas"),l=c.getContext("2d");c.width=o.videoWidth,c.height=o.videoHeight;const d=()=>{l.drawImage(o,0,0,c.width,c.height);const e=c.toDataURL();r.style.left=`${Math.max(66,Math.min(s,a.width-r.offsetWidth/2))}px`,r.style.backgroundImage=`url(${e})`,r.style.display="block",this.container.querySelector(".timestamp").innerText=this.#h(o.currentTime);const i=Array.from(t.querySelectorAll(".chapter-line")).find((e=>{const t=parseFloat(e.dataset.startTime),i=parseFloat(e.dataset.endTime);return o.currentTime>=t&&o.currentTime<=i}));this.container.querySelector(".chapter").innerText=i?i.dataset.text:"",o.removeEventListener("seeked",d)};isFinite(n*o.duration)&&!isNaN(n*o.duration)&&(o.currentTime=n*o.duration),o.addEventListener("seeked",d);const u=this.container.querySelector(".information");u.style.display="flex",u.style.left=`${Math.max(66,Math.min(s,a.width-r.offsetWidth/2))}px`})),t.addEventListener("mouseleave",(()=>{this.container.querySelector(".information").style.display="none"})),this.container.addEventListener("mouseleave",(function(){this.querySelector(".setting-container").classList.remove("active")})),this.#q(),this.container.querySelector(".settings").addEventListener("click",(function(){this.parentNode.classList.toggle("active")}))}#q(){if(this.container.querySelector(".closed-captions-bar")&&this.container.querySelector(".closed-captions-bar").addEventListener("mouseover",(()=>{this.container.querySelector(".preview-frame").style.display="none",this.container.querySelector(".information").style.display="none"})),this.container.querySelector('track[kind="subtitles"]')){const e=this.container.querySelectorAll('track[kind="subtitles"]');let t=!1;e.forEach((e=>{e.srclang===navigator.language.substring(0,2)?(e.setAttribute("checked","checked"),e.track.mode="hidden",this.container.querySelector(`.settings-menu-list-item[data-subtitle="${e.srclang}"]`).classList.add("checked"),t=!0):e.track.mode="disabled"})),t||e.forEach((e=>{e.label===this.config.defaultLang||e.srclang===this.config.defaultLang?(e.setAttribute("checked","checked"),e.track.mode="hidden",this.container.querySelector(`.settings-menu-list-item[data-subtitle="${e.srclang}"]`).classList.add("checked")):e.track.mode="disabled"})),this.container.querySelector(".cc").removeAttribute("disabled");const i=Array.from(e).find((e=>"subtitles"===e.getAttribute("kind")&&e.hasAttribute("checked")));i&&i.track.addEventListener("cuechange",(e=>{const t=this.container.querySelector(".closed-captions-text");activeCues&&activeCues.length>0&&(t.innerText=activeCues[0].text)}))}else this.container.querySelector(".cc").setAttribute("disabled",!0)}#S(){this.container.querySelectorAll("[data-settings]").forEach((e=>{e.addEventListener("click",(function(){this.parentNode.parentNode.querySelector(`.${this.getAttribute("data-settings")}`)&&(this.parentNode.parentNode.querySelector(`.${this.getAttribute("data-settings")}`).classList.add("active"),this.parentNode.classList.add("hidden"))}))})),this.container.querySelectorAll(".settings-back").forEach((e=>{e.addEventListener("click",(function(){this.parentNode.parentNode.parentNode.classList.remove("active"),this.parentNode.parentNode.parentNode.parentNode.querySelector(".settings-menu-list").classList.remove("hidden")}))})),this.container.querySelector(".cc-options").addEventListener("click",(()=>{this.container.querySelector(".option-cc").classList.remove("active"),this.container.querySelector(".option-cc-more").classList.add("active")})),this.container.querySelector(".settings-back-more").addEventListener("click",(()=>{this.container.querySelector(".option-cc-more").classList.remove("active"),this.container.querySelector(".option-cc").classList.add("active")})),this.container.querySelectorAll(".option-cc .settings-menu-list-item").forEach((e=>{e.addEventListener("click",(e=>{e="SPAN"!==e.target.tagName?e.target:e.target.parentNode,this.container.querySelectorAll(".option-cc .settings-menu-list-item").forEach((t=>{t.getAttribute("data-subtitle")===e.getAttribute("data-subtitle")?(t.classList.add("checked"),this.container.querySelector(`.video-frame track[kind="subtitles"][srclang="${e.getAttribute("data-subtitle")}"]`).setAttribute("checked","checked"),this.container.querySelector(`.video-frame track[kind="subtitles"][srclang="${e.getAttribute("data-subtitle")}"]`).track.mode="hidden"):(t.classList.remove("checked"),this.container.querySelector(`.video-frame track[kind="subtitles"][srclang="${t.getAttribute("data-subtitle")}"]`).removeAttribute("checked"),this.container.querySelector(`.video-frame track[kind="subtitles"][srclang="${t.getAttribute("data-subtitle")}"]`).track.mode="disabled")}));const t=this.container.querySelectorAll('.video-frame track[kind="subtitles"]');0!==t.length&&t.forEach((e=>{setTimeout((()=>{if("hidden"===e.track.mode){const t=e.track.activeCues,i=this.container.querySelector(".closed-captions-text");if(t&&t.length>0)i.innerText=t[0].text;else{const t=this.container.querySelector(".video-frame").currentTime,a=e.track.cues;a&&a.length>0&&Array.from(a).forEach((e=>{t>=e.startTime&&t<=e.endTime&&(i.innerText=e.text)}))}}const t=Array.from(this.container.querySelectorAll("track")).find((e=>"subtitles"===e.getAttribute("kind")&&e.hasAttribute("checked")));t&&t.track.addEventListener("cuechange",(e=>{const t=e.target.activeCues,i=this.container.querySelector(".closed-captions-text");t&&t.length>0&&(i.innerText=t[0].text)}))}),100)}))}))})),this.container.querySelector(".font-family").addEventListener("input",(e=>{"--family-small-capitals"===e.target.value?this.container.querySelector(".closed-captions-text").classList.add("small-caps"):this.container.querySelector(".closed-captions-text").classList.remove("small-caps"),this.container.style.setProperty("--video-cue-font",`var(${e.target.value})`)})),this.container.querySelector(".font-color").addEventListener("input",(e=>{const t=e.target.value;this.container.style.setProperty("--video-cue-font-color",`${color.parseRGB(color.name2rgb(t)).r}, ${color.parseRGB(color.name2rgb(t)).g}, ${color.parseRGB(color.name2rgb(t)).b}`)})),this.container.querySelector(".font-size").addEventListener("input",(e=>{const t=e.target.value;this.container.style.setProperty("--video-cue-font-size",`${t}%`);const i=this.container.querySelector(".video-frame"),a=this.container.querySelector(".closed-captions-bar");a.style.top=i.offsetHeight-a.offsetHeight-20+"px"})),this.container.querySelector(".bg-color").addEventListener("input",(e=>{const t=e.target.value;this.container.style.setProperty("--video-cue-bg",`${color.parseRGB(color.name2rgb(t)).r}, ${color.parseRGB(color.name2rgb(t)).g}, ${color.parseRGB(color.name2rgb(t)).b}`)})),this.container.querySelector(".bg-opacity").addEventListener("input",(e=>{const t=e.target.value;this.container.style.setProperty("--video-cue-bg-opacity",`${t}`)})),this.container.querySelector(".window-color").addEventListener("input",(e=>{const t=e.target.value;this.container.style.setProperty("--video-cue-window-color",`${color.parseRGB(color.name2rgb(t)).r}, ${color.parseRGB(color.name2rgb(t)).g}, ${color.parseRGB(color.name2rgb(t)).b}`)})),this.container.querySelector(".window-opacity").addEventListener("input",(e=>{const t=e.target.value;this.container.style.setProperty("--video-cue-window-opacity",`${t}`)})),this.container.querySelector(".font-opacity").addEventListener("input",(e=>{const t=e.target.value;this.container.style.setProperty("--video-cue-font-opacity",`${t}`)})),this.container.querySelectorAll("li[data-speed]").forEach((e=>{e.addEventListener("click",(function(){this.parentNode.querySelectorAll("li[data-speed]").forEach((e=>{e.classList.remove("checked")})),this.classList.add("checked");const e=parseFloat(this.getAttribute("data-speed"));this.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.querySelector(".video-frame").playbackRate=e}))})),setTimeout((()=>{this.container.querySelectorAll("li[data-quality]").forEach((e=>{e.addEventListener("click",(function(){this.parentNode.querySelectorAll("li[data-quality]").forEach((e=>{e.classList.remove("checked")})),this.classList.add("checked");const e=this.getAttribute("data-quality"),t=this.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.querySelector(".video-frame"),i=t.currentTime,a=!t.paused,s=Array.from(t.querySelectorAll("source")).find((t=>t.getAttribute("data-quality")===e));s&&(t.pause(),t.src=s.src,t.load(),t.currentTime=i,a&&t.play())}))}))}),100)}#k(e,t){return e===t}#b(){this.container.querySelectorAll(".playlist-item").forEach((e=>{e.addEventListener("click",(e=>{setTimeout((()=>{this.container.querySelector('track[kind="subtitles"]')?this.container.querySelector('[data-settings="option-cc"]').style.display="block":this.container.querySelector('[data-settings="option-cc"]').style.display="none"}),100);const t=e.target.parentNode.getAttribute("data-video")?e.target.parentNode.getAttribute("data-video"):e.target.parentNode.parentNode.getAttribute("data-video");if(null!==t){this.container.querySelectorAll(".chapter-line").forEach((e=>{e.remove()})),(e=>{const t=new URLSearchParams(window.location.search);t.set("v",e),window.history.pushState({},"",`${window.location.pathname}?v=${t.toString().replace(/v=/g,"")}`)})(t);const e=this.container.querySelector(".video-frame"),i=this.container.querySelector(".preview-video");e.innerHTML="",i.innerHTML="";const a=this.#d.find((e=>e.videoID===t)).videoName;Array.from(this.config.playlists).filter((e=>e.src.some((e=>e.src.match(a))))).map((t=>{t.src.forEach((a=>{this.container.querySelector(".video-title h1").innerText=t.title??"";const s=document.createElement("source");s.src=a.src,s.setAttribute("data-quality",a.quality),"auto"===a.quality&&(e.src=a.src,e.poster=t.poster),s.type=this.#u(a.src),e.appendChild(s);const n=document.createElement("source");n.src=a.src,n.setAttribute("data-quality",a.quality),"auto"===a.quality&&(i.src=a.src,i.poster=t.poster),n.type=this.#u(a.src),i.appendChild(n)})),t.tracks?.forEach((t=>{const i=document.createElement("track");i.src=t.src,i.kind=t.kind,i.srclang=t.srclang,i.label=t.label,i.track.mode="disabled",e.appendChild(i)}))})),e.querySelector('track[kind="subtitles"]')?this.container.querySelector(".cc").removeAttribute("disabled"):(this.container.querySelector(".closed-captions-bar.active")&&this.container.querySelector(".cc.active").click(),this.container.querySelector(".cc").setAttribute("disabled",!0)),this.container.querySelector(".progress-bar").style.width="0%",e.load(),i.load()}}));const t=new URLSearchParams(window.location.search);if(null!==t.get("v")&&""!==t.get("v")){this.container.querySelectorAll(".chapter-line").forEach((e=>{e.remove()}));const e=this.container.querySelector(".video-frame"),i=this.container.querySelector(".preview-video");let a;if(e.innerHTML="",i.innerHTML="",!this.#d.find((e=>e.videoID===t.get("v"))))return this.container.querySelector(".videoNotFound").style.display="block",void this.container.querySelector(".controls").classList.add("noShow");a=this.#d.find((e=>e.videoID===t.get("v"))).videoName,Array.from(this.config.playlists).filter((e=>e.src.some((e=>e.path.match(a))))).map((t=>{t.src.forEach((a=>{this.container.querySelector(".video-title h1").innerText=t.title??"";const s=document.createElement("source");s.src=a.path,s.setAttribute("data-quality",a.quality),"auto"===a.quality&&(e.src=a.path,e.poster=t.poster),s.type=this.#u(a.path),e.appendChild(s);const n=document.createElement("source");n.src=a.path,n.setAttribute("data-quality",a.quality),"auto"===a.quality&&(i.src=a.path,i.poster=t.poster),n.type=this.#u(a.path),i.appendChild(n)})),t.tracks?.forEach((t=>{const i=document.createElement("track");i.src=t.src,i.kind=t.kind,i.srclang=t.srclang,i.label=t.label,this.#k(t.srclang,navigator.language.substring(0,2))?i.track.mode="hidden":i.track.mode="disabled",e.appendChild(i)}))})),e.querySelector('track[kind="subtitles"]')?this.container.querySelector(".cc").removeAttribute("disabled"):(this.container.querySelector(".closed-captions-bar.active")&&this.container.querySelector(".cc.active").click(),this.container.querySelector(".cc").setAttribute("disabled",!0)),e.load(),i.load()}}))}on(e,t){setTimeout((()=>{this.eventTracker[e]?this.eventTracker[e].push(t):this.eventTracker[e]=[t],this.container.querySelector(".video-frame").addEventListener(e,(t=>{this.eventTracker[e].forEach((e=>{e(t)}))}))}),300)}getDebug(){return new Promise((e=>{const t=this.container.querySelector(".video-frame");this.debug={video:{error:t.error,src:t.currentSrc.replace(/https?:\/\//,"//"),crossOrigin:t.crossOrigin,networkState:t.networkState,duration:t.duration,videoWidth:t.videoWidth,videoHeight:t.videoHeight,preload:t.preload,buffered:Array.from({length:t.buffered.length},((e,i)=>[t.buffered.start(i),t.buffered.end(i)])).flat(),readyState:t.readyState,seeking:t.seeking,currentTime:t.currentTime,duration:t.duration,playbackRate:t.playbackRate,paused:t.paused,ended:t.ended,volume:t.volume,muted:t.muted,defaultPlaybackRate:t.defaultPlaybackRate,controls:this.config.controls,autoplay:t.autoplay},info:{loadstart:this.eventTracker.loadstart?.length??0,suspend:this.eventTracker.suspend?.length??0,abort:this.eventTracker.abort?.length??0,error:this.eventTracker.error?.length??0,emptied:this.eventTracker.emptied?.length??0,stalled:this.eventTracker.stalled?.length??0,loadmetadata:this.eventTracker.loadedmetadata?.length??0,loadeddata:this.eventTracker.loadeddata?.length??0,canplay:this.eventTracker.canplay?.length??0,canplaythrough:this.eventTracker.canplaythrough?.length??0,playing:this.eventTracker.playing?.length??0,waiting:this.eventTracker.waiting?.length??0,seeking:this.eventTracker.seeking?.length??0,seeked:this.eventTracker.seeked?.length??0,ended:this.eventTracker.ended?.length??0,durationchange:this.eventTracker.durationchange?.length??0,timeupdate:this.eventTracker.timeupdate?.length??0,progress:this.eventTracker.progress?.length??0,ratechange:this.eventTracker.ratechange?.length??0,resize:this.eventTracker.resize?.length??0,volumechange:this.eventTracker.volumechange?.length??0}},e(this.debug)}))}}export class AudioPlayer{#L={};constructor(e,t,i={},a=!0){isLoaded()&&(this.container=document.querySelector(e),this.config={autoplay:!1,loop:!1,shuffle:!1,controls:!0,preloaded:"auto",playlists:[],tracks:[],availablePlayback:[.25,.5,.75,1,1.25,1.5,1.75,2],skipRate:5},this.styles={},this.eventTracker={},this.audioID={},Object.assign(this.config,t),Object.assign(this.styles,i),Array.from(this.config.playlists).map((e=>{const t=new Audio;t.src=e.src[0].path,genID(fileName(e.src[0].path)).then((t=>{this.audioID[e.src[0].title]=t})),t.addEventListener("loadedmetadata",(()=>{this.#L[e.src[0].title]=this.#h(t.duration)})),t.load()})),this.config.autoplay=JSON.parse(window.localStorage.getItem("mediaViewer_audio_config"))?.autoplay??this.config.autoplay,setTimeout((()=>{if(!new URLSearchParams(window.location.search).get("a")){const e=window.location.search?"&":"?";window.history.pushState({},"",`${window.location.pathname}${e}a=${Object.values(this.audioID)[0]}`)}this.container instanceof HTMLElement&&a&&this.init(),this.config.controls&&(this.#m(),this.#y(),this.#g(),this.#w(),this.#E())}),200))}#$(e){switch(e.split(".").pop().toLowerCase()){case"mp3":return"audio/mpeg";case"wav":return"audio/wav";case"ogg":return"audio/ogg";default:return"audio/mpeg"}}#h(e){const t=Math.floor(e/3600),i=Math.floor(e%3600/60),a=Math.floor(e%60);return t>0?`${String(t).padStart(2,"0")}:${String(i).padStart(2,"0")}:${String(a).padStart(2,"0")}`:`${String(i).padStart(2,"0")}:${String(a).padStart(2,"0")}`}#m(){const e=document.createElement("i");e.className="fa-solid fa-volume btn volume",e.title="Mute (m)";const t=this.container.querySelector(".audio-player-obj");e.addEventListener("click",(function(){const i=this.parentNode.querySelector("input"),a=this.styles&&this.styles["volume-track-before"]?this.styles["volume-track-before"]:"#e7e7e7",s=this.styles&&this.styles["volume-track-after"]?this.styles["volume-track-after"]:"#c8c8c8";0==i.value?(i.value=100,this.className="fa-solid fa-volume btn volume",e.title="Mute (m)",t.volume=1,i.style.background=`linear-gradient(90deg, ${a} 100%, ${s} 100%)`):(i.value=0,this.className="fa-solid fa-volume-slash btn volume",e.title="Unmute (m)",t.volume=0,i.style.background=`linear-gradient(90deg, ${a} 0%, ${s} 0%)`)})),this.container.querySelector(".player-container .volume-holder").appendChild(e)}#y(){const e=document.createElement("input");e.type="range",e.classList.add("volumeRange"),e.min=0,e.max=100,e.value=100;const t=this.styles["volume-track-before"]??"#e7e7e7",i=this.styles["volume-track-after"]??"#c8c8c8",a=this.container.querySelector(".audio-player-obj");e.addEventListener("input",(function(){const e=(this.value-this.min)/(this.max-this.min)*100;this.style.background=`linear-gradient(90deg, ${t} ${e}%, ${i} ${e}%)`;const s=this.parentNode.querySelector(".btn");100==this.value&&(s.className="fa-solid fa-volume btn volume"),this.value<100&&this.value>0&&(s.className="fa-solid fa-volume-low btn volume"),0==this.value&&(s.className="fa-solid fa-volume-slash btn volume"),a.volume=this.value/100})),this.container.querySelector(".player-container .volume-holder").appendChild(e)}#g(){this.container.querySelector(".play-pause").addEventListener("click",(()=>{this.container.querySelector(".audio-player-obj").paused?(this.container.querySelector(".audio-player-obj").play(),this.container.querySelector(".play-pause").title="Pause"):(this.container.querySelector(".audio-player-obj").pause(),this.container.querySelector(".play-pause").title="Play")}))}init(){this.params=new URLSearchParams(window.location.search),this.container.tabIndex=0,this.container.classList.add("audio"),Object.keys(this.styles).forEach((e=>{this.container.style.setProperty(`--audio-${e}`,this.styles[e])})),this.container.innerHTML+=`<audio class="audio-player-obj"${this.config.loop?" loop":""}>\n            ${Array.from(this.config.playlists).filter((e=>e.src.some((e=>this.audioID[e.title]===this.params.get("a"))))).flatMap((e=>e.src.map((e=>`<source src="${e.path}" type="${this.#$(e.path)}"/>`)))).join("")}\n            ${Array.isArray(this.config.playlists.find((e=>this.audioID[e.src[0].title]===this.params.get("a")))?.tracks)?this.config.playlists.find((e=>this.audioID[e.src[0].title]===this.params.get("a"))).tracks.map((e=>`<track src="${e.src}" kind="${e.kind}" srclang="${e.srclang}" label="${e.label}"/>`)).join(""):""}\n        </audio>\n        <div class="audio-player">\n            <div class="player-container">\n                <div class="player-img">${this.config.playlists.filter((e=>e.src.some((e=>this.audioID[e.title]===this.params.get("a"))))).flatMap((e=>e.src.map((e=>`<img src="${e.img?e.img:"https://img.freepik.com/free-vector/music-notes-stave-staff_1284-44373.jpg?semt=ais_hybrid&w=740"}" alt="${e.title}"/>`)))).join("")}</div>\n                    <p class="audio-captions"></p>\n                <div class="audio-title"><h1>${this.config.playlists.filter((e=>e.src.some((e=>this.audioID[e.title]===this.params.get("a"))))).flatMap((e=>e.src.map((e=>e.title)))).join("")}</h1></div>\n\n                <div class="controls">\n                    <div class="progress">\n                        <div class="progress-buffer"></div>\n                        <div class="progress-hover"></div>\n                        <div class="progress-bar"></div>\n                    </div>\n                    <div class="audio-controls${this.config.controls?"":" noControls"}">\n                        <button class="btn audio-loop${this.config.loop?" active":""}"><i class="fa-solid fa-repeat"></i></button>\n                        <div class="options option-playback dropup">\n                            <button class="dropup-button"><i class="fa-solid fa-sliders-up"></i></button>\n                            <ul class="settings-menu-list dropup-content">\n                                ${Array.from(this.config.availablePlayback).map((e=>`<li class="settings-menu-list-item${1==e?" checked":""}" data-speed="${e}"><span>${1==e?"Normal":`${e}x`}</span></li>`)).join("")}\n                            </ul>\n                        </div>\n                        <button class="btn audio-prev"><i class="fa-solid fa-backward"></i></button>\n                        <button class="btn audio-toggleStatus play-pause"><i class="fa-solid fa-play"></i></button>\n                        <button class="btn audio-next"><i class="fa-solid fa-forward"></i></button>\n                        <div class="container volume-container">\n                            <div class="volume-holder">\n                            </div>\n                        </div>\n                        <div class="timestamp">\n                            <span class="current">00:00</span>/<span class="duration">0:00</span>\n                        </div>\n                        <button class="btn audio-shuffle${this.config.shuffle?" active":""}"><i class="fa-solid fa-shuffle"></i></button>\n                        <label class="toggle-switch">\n                            <input type="checkbox" class="autoplay" ${this.config.autoplay?' checked="checked"':""}>\n                            <span class="slider"></span>\n                        </label>\n                    </div>\n                </div>\n\n            </div>\n            <div class="playlist">\n                <table class="playlist-table">\n                    <thead>\n                        <tr>\n                            <th>#</th>\n                            <th>Title</th>\n                            <th>Artist</th>\n                            <th>Album</th>\n                            <th><i class="fa-regular fa-clock"></i></th>\n                        </tr>\n                    </thead>\n                    <tbody>\n                        ${(()=>{const e=Array.from(this.config.playlists);if(this.config.shuffle)for(let t=e.length-1;t>0;t--){const i=Math.floor(Math.random()*(t+1));[e[t],e[i]]=[e[i],e[t]]}return e.map((e=>`<tr data-audio-id="${this.audioID[e.src[0].title]}">\n                                <td></td>\n                                <td>${e.src[0]?.img?`<img class="playlist-img" src="${e.src[0].img}" alt="${e.src[0].title}"/>`:""}<span class="playlist-title">${e.src[0].title}</span></td>\n                                <td>${e.src[0].artist}</td>\n                                <td><span class="album-title">${e.src[0]?.album??""}</span></td>\n                                <td>${this.#L[e.src[0].title]}</td>\n                                </tr>`)).join("")})()}\n                    </tbody>\n                </table>\n            </div>\n        </div>`}getInstance(){return this}#A(){const e=this.container.querySelector("audio"),t=this.container.querySelector(".audio-captions");t.innerText="";const i=Array.from(e.querySelectorAll('track[kind="captions"]'));let a=i.find((e=>e.srclang===navigator.language.substring(0,2)))||i[0];a&&(a.track.mode="hidden",a.track.addEventListener("cuechange",(()=>{const e=a.track.activeCues;e&&e.length>0?t.innerText=e[0].text:t.innerText=""})))}#w(){this.container.querySelector("audio").addEventListener("loadeddata",(()=>{if(this.config.autoplay){var e=!1;window.addEventListener("click",(()=>{e||(e=!0,this.container.querySelector(".play-pause").click())}))}this.container.querySelector(".timestamp .duration").innerText=`${this.#h(this.container.querySelector("audio").duration)}`})),this.container.querySelector("audio").addEventListener("pause",(function(){this.parentNode.querySelector(".play-pause i").className=this.parentNode.querySelector(".play-pause i").className.replace("fa-pause","fa-play")})),this.container.querySelector("audio").addEventListener("playing",(function(){this.parentNode.querySelector(".play-pause i").className=this.parentNode.querySelector(".play-pause i").className.replace("fa-play","fa-pause")})),this.container.querySelector("audio").addEventListener("timeupdate",(e=>{const t=this.container.querySelector(".progress-bar"),i=e.target.currentTime/e.target.duration*100;t.style.width=`${i}%`,this.container.querySelector(".timestamp .current").innerText=`${this.#h(this.container.querySelector("audio").currentTime)}`})),this.container.querySelector("audio").addEventListener("progress",(function(){const e=this.parentNode.querySelector(".progress-buffer");if(this.buffered.length>0){const t=this.buffered.end(this.buffered.length-1)/this.duration*100;e.style.width=`${t}%`}})),this.container.querySelector(".progress").addEventListener("mousemove",(function(e){const t=this.getBoundingClientRect(),i=e.clientX-t.left,a=Math.max(0,Math.min(i/t.width*100,100));this.querySelector(".progress-hover").style.width=`${a}%`})),this.container.querySelector(".progress").addEventListener("mouseleave",(function(){this.querySelector(".progress-hover").style.width="0%"})),this.container.querySelector(".progress").addEventListener("click",(function(e){const t=this.parentNode.parentNode.parentNode.parentNode.querySelector("audio"),i=this.getBoundingClientRect(),a=(e.clientX-i.left)/i.width;isFinite(a*t.duration)&&!isNaN(a*t.duration)&&(t.currentTime=a*t.duration)}));let e=!1;this.container.querySelector(".progress").addEventListener("mousedown",(()=>{e=!0})),this.container.querySelector(".progress").addEventListener("mouseup",(()=>{e=!1})),this.container.querySelector(".progress").addEventListener("mousemove",(t=>{if(e){const e=t.currentTarget.getBoundingClientRect(),i=(t.clientX-e.left)/e.width,a=this.container.querySelector("audio");isFinite(i*a.duration)&&!isNaN(i*a.duration)&&(a.currentTime=i*a.duration)}})),this.container.querySelector(".progress").addEventListener("touchstart",(()=>{e=!0})),this.container.querySelector(".progress").addEventListener("touchend",(()=>{e=!1})),this.container.querySelector(".progress").addEventListener("touchmove",(t=>{if(e){const e=t.currentTarget.getBoundingClientRect(),i=(t.touches[0].clientX-e.left)/e.width,a=this.container.querySelector("audio");isFinite(i*a.duration)&&!isNaN(i*a.duration)&&(a.currentTime=i*a.duration)}})),this.container.addEventListener("keydown",(e=>{const t=e.key||e.keyCode||e.which,i=this.container.querySelector("audio");if("ArrowLeft"!==t&&37!=t||(e.preventDefault(),i.currentTime=Math.max(0,i.currentTime-this.config.skipRate)),"ArrowRight"!==t&&39!=t||(e.preventDefault(),i.currentTime=Math.min(i.duration,i.currentTime+this.config.skipRate)),"m"===t||77==t){const e=this.container.querySelector("audio");e.muted=!e.muted;const t=this.container.querySelector(".volume"),i=this.container.querySelector(".volumeRange"),a=this.styles["volume-track-before"]??"#e7e7e7",s=this.styles["volume-track-after"]??"#c8c8c8";e.muted?(t.className="fa-solid fa-volume-slash btn volume",i.value=i.min,t.title="Unmute (m)",i.style.background=`linear-gradient(90deg, ${a} 0%, ${s} 0%)`):(t.className="fa-solid fa-volume btn volume",i.value=i.max,t.title="Mute (m)",i.style.background=`linear-gradient(90deg, ${a} 100%, ${s} 100%)`)}" "!==t&&39!=t||this.container.querySelector(".play-pause").click()})),this.container.querySelectorAll("[data-audio-id]").forEach((e=>{e.addEventListener("click",(()=>{this.container.querySelector(".progress-buffer").style.width="0%",this.container.querySelector(".progress-bar").style.width="0%",this.container.querySelector(".play-pause i").className="fa-solid fa-play";const t=e.getAttribute("data-audio-id"),i=this.config.playlists.find((e=>this.audioID[e.src[0].title]===t));if(i){const a=this.container.querySelector(".audio-player-obj");a.innerHTML=i.src.map((e=>`<source src="${e.path}" type="${this.#$(e.path)}"/>`)).join(""),i.tracks&&i.tracks.length>0?(this.container.querySelector(".audio-captions").classList.add("showing"),i.tracks.forEach((e=>{const t=document.createElement("track");t.src=e.src,t.kind=e.kind,t.srclang=e.srclang,t.label=e.label,a.appendChild(t)})),this.#A()):this.container.querySelector(".audio-captions").classList.remove("showing"),this.container.querySelector(".player-img img").src=i.src[0].img||"https://img.freepik.com/free-vector/music-notes-stave-staff_1284-44373.jpg?semt=ais_hybrid&w=740",this.container.querySelector(".player-container h1").innerText=i.src[0].title,this.container.querySelector(".timestamp .duration").innerText=this.#L[i.src[0].title]||"0:00";const s=new URLSearchParams(window.location.search);s.set("a",t),window.history.pushState({},"",`${window.location.pathname}?${s.toString()}`),a.load(),this.container.querySelectorAll("[data-audio-id]").forEach((e=>e.classList.remove("playing"))),e.classList.add("playing")}}))})),this.container.querySelectorAll("[data-speed]").forEach((e=>{e.addEventListener("click",(()=>{const t=parseFloat(e.getAttribute("data-speed"));this.container.querySelector(".audio-player-obj").playbackRate=t,this.container.querySelectorAll("[data-speed]").forEach((e=>{e.classList.remove("checked")})),e.classList.add("checked")}))})),this.container.querySelector(".dropup").addEventListener("mouseover",(()=>{this.container.querySelector(".dropup .dropup-content").style.display="block"})),this.container.querySelector(".dropup").addEventListener("mouseleave",(()=>{this.container.querySelector(".dropup .dropup-content").style.display="none"})),this.container.querySelector(".audio-prev").addEventListener("click",(()=>{const e=Array.from(this.container.querySelectorAll("[data-audio-id]")),t=e.findIndex((e=>e.classList.contains("playing")));e[(t-1+e.length)%e.length].click(),this.#A(),this.config.autoplay&&this.container.querySelector(".play-pause").click()})),this.container.querySelector(".audio-next").addEventListener("click",(()=>{const e=Array.from(this.container.querySelectorAll("[data-audio-id]")),t=e.findIndex((e=>e.classList.contains("playing")));let i;if(this.container.querySelector(".audio-shuffle").classList.contains("active"))do{i=Math.floor(Math.random()*e.length)}while(i===t);else i=(t+1)%e.length;e[i].click(),this.#A(),this.config.autoplay&&this.container.querySelector(".play-pause").click()})),this.container.querySelector("audio").addEventListener("ended",(()=>{this.container.querySelector(".audio-next").click()})),this.container.querySelector(".audio-loop").addEventListener("click",(e=>{e.target.parentNode.classList.toggle("active"),e.target.parentNode.classList.contains("active")?this.container.querySelector("audio").loop=!0:this.container.querySelector("audio").loop=!1})),this.container.querySelector(".audio-shuffle").addEventListener("click",(e=>{e.target.parentNode.classList.toggle("active")})),this.container.querySelector(".autoplay").addEventListener("input",(function(){window.localStorage.setItem("mediaViewer_audio_config",JSON.stringify({autoplay:this.checked}))}))}#E(){this.container.querySelectorAll("table tbody tr").forEach((e=>{e.getAttribute("data-audio-id").match(new RegExp(`^${this.params.get("a")}$`))&&e.classList.add("playing")})),this.container.querySelector("audio track")&&this.container.querySelector(".audio-captions").classList.add("showing"),this.#A()}on(e,t){setTimeout((()=>{this.eventTracker[e]?this.eventTracker[e].push(t):this.eventTracker[e]=[t],this.container.querySelector("audio").addEventListener(e,(t=>{this.eventTracker[e].forEach((e=>{e(t)}))}))}),300)}}
